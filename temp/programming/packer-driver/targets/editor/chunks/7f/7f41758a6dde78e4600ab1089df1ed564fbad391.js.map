{"version":3,"sources":["file:///Users/super_javan/cocoscreator/PlayCard/assets/Script/Model/GameDB.ts"],"names":["PokerGrop","GameDB","EventMgr","ECardDir","EnumSuit","EventGame_Enum","Poker","_pokers","pokers","addPoker","poker","push","RECEIVE_AREA_COUNT","PLAY_AREA_COUNT","getInstance","instance","constructor","cardTotal","cardSuits","_closePokers","_openPokers","_receiveArea","_playArea","initEvent","on","EVENT_PLAYAREA_TO_RECEIVE_UPDATE_DB","onPlayToReceive","createCardsDB","i","j","suit","HeiTao","HongTao","MeiHua","FangKuai","CLOSE","index","receiveGroup","emit","EVENT_GAME_INIT","gamePlay","shuffle","temp","EVENT_GAME_START","createPlayInitDB","shuffleTime","snd","parseInt","Math","random","length","rnd","count","dis","groupIndex","pokerGrop","EVENT_GAME_INIT_GROUP","console","log","onCheckInPlayArea","filter","gp","p","k","onCheckIndexTop","topPoker","closePokers","openPokers","playArea","receiveArea"],"mappings":"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","sourcesContent":["import EventMgr from \"../Base/Event/EventMgr\"\nimport { ECardDir, EnumSuit, EventGame_Enum } from \"../Enum\"\nimport Poker from \"./Poker\"\n\nexport class PokerGrop {\n    private _pokers: Poker[] = []\n    public get pokers(): Poker[] {\n        return this._pokers\n    }\n\n    public addPoker(poker: Poker) {\n        this._pokers.push(poker)\n    }\n}\n\nexport const RECEIVE_AREA_COUNT: number = 4\nexport const PLAY_AREA_COUNT: number = 7\nexport default class GameDB {\n    private static instance: any = null\n    static getInstance() {\n        if (this.instance == null) {\n            this.instance = new GameDB()\n        }\n        return this.instance\n    }\n\n    private readonly cardTotal: number = 13\n    private readonly cardSuits: number = 4\n\n    private _pokers: Poker[] = []\n\n    /** 发牌区数据*/\n    private _closePokers: Poker[] = []\n    /** 开牌区数据*/\n    private _openPokers: Poker[] = []\n    /** 收牌区数据*/\n    private _receiveArea: PokerGrop[] = []\n    /** 玩牌区数据*/\n    private _playArea: PokerGrop[] = []\n\n    constructor() {\n        this.initEvent()\n    }\n\n    //绑定事件\n    initEvent() {\n        EventMgr.getInstance().on(EventGame_Enum.EVENT_PLAYAREA_TO_RECEIVE_UPDATE_DB, this.onPlayToReceive, this)\n    }\n\n    //创建初始数据\n    createCardsDB() {\n        for (let i = 1; i <= this.cardTotal; i++) {\n            for (let j = 0; j < this.cardSuits; j++) {\n                let suit: EnumSuit = EnumSuit.HeiTao\n                switch (j) {\n                    case 1:\n                        suit = EnumSuit.HongTao\n                        break;\n                    case 2:\n                        suit = EnumSuit.MeiHua\n                        break;\n                    case 3:\n                        suit = EnumSuit.FangKuai\n                        break;\n\n                    default:\n                        suit = EnumSuit.HeiTao\n                        break;\n                }\n\n                let poker = new Poker(i, suit, ECardDir.CLOSE)\n                this._pokers.push(poker)\n            }\n        }\n\n        for (let index = 0; index < RECEIVE_AREA_COUNT; index++) {\n            let receiveGroup = new PokerGrop()\n            this._receiveArea.push(receiveGroup)\n        }\n\n        for (let index = 0; index < PLAY_AREA_COUNT; index++) {\n            let receiveGroup = new PokerGrop()\n            this._playArea.push(receiveGroup)\n        }\n\n        EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_INIT, this._pokers)\n    }\n\n    gamePlay() {\n        this.shuffle(this._pokers, 200)\n        let temp = this._pokers\n        this._closePokers = this.pokers\n        this._pokers = temp\n\n        EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_START)\n\n        this.createPlayInitDB()\n    }\n    /**洗牌 */\n    shuffle(pokers: Poker[], shuffleTime: number = 100) {\n        for (let index = 0; index < shuffleTime; index++) {\n            // let snd = Math.floor(Math.random() * pokers.length - 1)\n            // let rnd = Math.floor(Math.random() * pokers.length - 1)\n            let snd = parseInt('' + Math.random() * pokers.length, 10)\n            let rnd = parseInt('' + Math.random() * pokers.length, 10)\n\n            let temp = pokers[snd]\n            pokers[snd] = pokers[rnd]\n            pokers[rnd] = temp\n        }\n    }\n    createPlayInitDB() {\n        for (let count = PLAY_AREA_COUNT; count >= 1; count--) {\n            for (let i = 0; i < count; i++) {\n                let dis = PLAY_AREA_COUNT - count\n                let groupIndex = dis + i\n                let pokerGrop = this._playArea[groupIndex]\n                let poker = this._closePokers[this._closePokers.length - 1]\n                this._closePokers.length = this._closePokers.length - 1\n                // poker.dir = i == 0 ? poker.dir = ECardDir.OPEN : poker.dir = ECardDir.CLOSE\n                pokerGrop.addPoker(poker)\n                EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_INIT_GROUP, groupIndex, dis, poker, i)\n            }\n        }\n    }\n\n    onPlayToReceive(poker: Poker) {\n        console.log(' 更改 db数据层....', poker)\n    }\n\n    //检测这张牌是否在play area\n    onCheckInPlayArea(poker: Poker): boolean {\n        this._playArea.filter((gp, i) => {\n            if (gp.pokers.length <= 0) {\n                return false\n            }\n\n            gp.pokers.filter((p, k) => {\n                if (p.count == poker.count)\n                    return true\n            })\n        })\n\n        return false\n    }\n\n    //检测是否在顶部\n    onCheckIndexTop(poker: Poker) {\n        for (const gp of this._playArea) {\n            let pokers = gp.pokers\n            let topPoker = pokers[pokers.length - 1]\n            if (topPoker.count == poker.count)\n                return true\n        }\n\n        return false\n    }\n\n    public get pokers(): Poker[] { return this._pokers }\n    public get closePokers(): Poker[] { return this._closePokers }\n    public get openPokers(): Poker[] { return this._openPokers }\n    public get playArea(): PokerGrop[] { return this._playArea }\n    public get receiveArea(): PokerGrop[] { return this._receiveArea }\n}\n"]}