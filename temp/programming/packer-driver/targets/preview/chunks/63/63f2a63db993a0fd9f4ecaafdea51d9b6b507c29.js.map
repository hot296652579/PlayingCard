{"version":3,"sources":["file:///Users/super_javan/cocoscreator/PlayCard/assets/Script/Model/GameDB.ts"],"names":["PokerGrop","ReceiveGroup","PlayGroup","CloseGroup","OpenGroup","GameDB","EventMgr","ECardDir","ENumSiut","EnumSuit","EventGame_Enum","Poker","index","_pokers","pokers","addPoker","poker","parent","push","removePoker","topPoker","groupTop","length","getPoker","groupIsEmpty","i","suit","isNextPoker","count","dir","OPEN","getInstance","emit","EVENT_OPEN_TOPPOKER_UPDATE_VIEW","RECEIVE_AREA_COUNT","PLAY_AREA_COUNT","instance","constructor","cardTotal","cardSuits","_closeGroup","_openGroup","_openPokers","_receiveArea","_playArea","initEvent","on","EVENT_PLAYAREA_TO_RECEIVE_UPDATE_DB","onPlayToReceive","EVENT_CLOSEAREA_TO_OPEN_UPDATE_DB","onCloseToOpen","EVENT_OPEN_TO_RECEIVE_UPDATE_DB","onOpenToReceive","resetGame","createCardsDB","j","HeiTao","HongTao","MeiHua","FangKuai","CLOSE","receiveGroup","EVENT_GAME_INIT","gamePlay","shuffle","temp","forEach","p","EVENT_GAME_START","createPlayInitDB","shuffleTime","snd","parseInt","Math","random","rnd","dis","groupIndex","playPokerGrop","EVENT_GAME_INIT_GROUP","group","EVENT_PLAYAREA_TO_RECEIVE_UPDATE_VIEW","openGroup","EVENT_CLOSEAREA_TO_OPEN_UPDATE_VIEW","EVENT_OPEN_TO_RECEIVE_UPDATE_VIEW","onCheckInPlayArea","playArea","filter","pg","onCheckIndexTop","gp","onCheckInCloseArea","closeGroup","onCheckIndexByCloseTop","console","log","onCheckInOpenArea","onCheckIndexByOpenTop","openPokers","receiveArea"],"mappings":"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","sourcesContent":["import EventMgr from \"../Base/Event/EventMgr\"\nimport { ECardDir, ENumSiut, EnumSuit, ESuitNum, EventGame_Enum } from \"../Enum\"\nimport Poker from \"./Poker\"\n\nexport class PokerGrop {\n    public index: number = null\n    public _pokers: Poker[] = []\n    public get pokers(): Poker[] {\n        return this._pokers\n    }\n\n    public addPoker(poker: Poker) {\n        poker.parent = this\n        this._pokers.push(poker)\n    }\n\n    public removePoker(poker) {\n        let topPoker = this.groupTop\n        if (poker == topPoker) {\n            this._pokers.length = this._pokers.length - 1\n            poker.parent = null\n\n            return poker\n        }\n    }\n\n    public getPoker(index: number) {\n        if (!this.groupIsEmpty()) {\n            let i = index >= 0 ? index : this.pokers.length + index\n            if (i < this.pokers.length) {\n                return this.pokers[i]\n            }\n        }\n        return null\n\n    }\n\n    public groupIsEmpty() {\n        return this._pokers.length == 0\n    }\n\n    public get groupTop() {\n        return this.groupIsEmpty() ? null : this._pokers[this._pokers.length - 1]\n    }\n}\n\nclass ReceiveGroup extends PokerGrop {\n    public suit: number = null\n\n    public isNextPoker(poker: Poker) {\n        if (ENumSiut[this.suit] === poker.suit) {\n            if (this.groupTop) {\n                return this.groupTop.count + 1 == poker.count\n            } else {\n                return poker.count == 1\n            }\n        }\n\n        return false\n    }\n}\n\nclass PlayGroup extends PokerGrop {\n    public removePoker(poker: Poker) {\n        super.removePoker(poker)\n        if (!this.groupIsEmpty()) {\n            let topPoker = this.groupTop\n            topPoker.dir = ECardDir.OPEN\n\n            EventMgr.getInstance().emit(EventGame_Enum.EVENT_OPEN_TOPPOKER_UPDATE_VIEW, topPoker)\n        }\n    }\n}\n\nclass CloseGroup extends PokerGrop { }\nclass OpenGroup extends PokerGrop {\n    public addPoker(poker: Poker): Poker {\n        super.addPoker(poker)\n        // poker.dir = ECardDir.OPEN\n        return poker\n    }\n}\n\nexport const RECEIVE_AREA_COUNT: number = 4\nexport const PLAY_AREA_COUNT: number = 7\nexport default class GameDB {\n    private static instance: any = null\n    static getInstance() {\n        if (this.instance == null) {\n            this.instance = new GameDB()\n        }\n        return this.instance\n    }\n\n    private readonly cardTotal: number = 13\n    private readonly cardSuits: number = 4\n\n    private _pokers: Poker[] = []\n\n    /** 发牌区盖着的数据*/\n    private _closeGroup: CloseGroup = new CloseGroup()\n    /** 发牌区打开着的数据*/\n    private _openGroup: OpenGroup = new OpenGroup()\n    /** 开牌区数据*/\n    private _openPokers: Poker[] = []\n    /** 收牌区数据*/\n    private _receiveArea: ReceiveGroup[] = []\n    /** 玩牌区数据*/\n    private _playArea: PokerGrop[] = []\n\n    constructor() {\n        this.initEvent()\n    }\n\n    //绑定事件\n    initEvent() {\n        EventMgr.getInstance().on(EventGame_Enum.EVENT_PLAYAREA_TO_RECEIVE_UPDATE_DB, this.onPlayToReceive, this)\n        EventMgr.getInstance().on(EventGame_Enum.EVENT_CLOSEAREA_TO_OPEN_UPDATE_DB, this.onCloseToOpen, this)\n        EventMgr.getInstance().on(EventGame_Enum.EVENT_OPEN_TO_RECEIVE_UPDATE_DB, this.onOpenToReceive, this)\n    }\n\n    resetGame() {\n        this._pokers = []\n        this._openPokers = []\n        this._receiveArea = []\n        this._closeGroup._pokers = []\n        this._playArea = []\n    }\n\n    //创建初始数据\n    createCardsDB() {\n        for (let i = 1; i <= this.cardTotal; i++) {\n            for (let j = 0; j < this.cardSuits; j++) {\n                let suit: EnumSuit = EnumSuit.HeiTao\n                switch (j) {\n                    case 1:\n                        suit = EnumSuit.HongTao\n                        break;\n                    case 2:\n                        suit = EnumSuit.MeiHua\n                        break;\n                    case 3:\n                        suit = EnumSuit.FangKuai\n                        break;\n\n                    default:\n                        suit = EnumSuit.HeiTao\n                        break;\n                }\n\n                let poker = new Poker(i, suit, ECardDir.CLOSE)\n                this._pokers.push(poker)\n            }\n        }\n\n        for (let index = 0; index < RECEIVE_AREA_COUNT; index++) {\n            let receiveGroup = new ReceiveGroup()\n            receiveGroup.index = this._receiveArea.length\n            receiveGroup.suit = index\n            this._receiveArea.push(receiveGroup)\n        }\n\n        for (let index = 0; index < PLAY_AREA_COUNT; index++) {\n            let receiveGroup = new PlayGroup()\n            receiveGroup.index = this._playArea.length\n            this._playArea.push(receiveGroup)\n        }\n\n        EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_INIT, this._pokers)\n    }\n\n    gamePlay() {\n        this.shuffle(this._pokers, 500)\n        let temp = this._pokers\n        // this._closeGroup._pokers = this.pokers\n        this.pokers.forEach(p => this._closeGroup.addPoker(p))\n        this._pokers = temp\n\n        EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_START)\n\n        this.createPlayInitDB()\n    }\n    /**洗牌 */\n    shuffle(pokers: Poker[], shuffleTime: number = 100) {\n        for (let index = 0; index < shuffleTime; index++) {\n            // let snd = Math.floor(Math.random() * pokers.length - 1)\n            // let rnd = Math.floor(Math.random() * pokers.length - 1)\n            let snd = parseInt('' + Math.random() * pokers.length, 10)\n            let rnd = parseInt('' + Math.random() * pokers.length, 10)\n\n            let temp = pokers[snd]\n            pokers[snd] = pokers[rnd]\n            pokers[rnd] = temp\n        }\n    }\n    createPlayInitDB() {\n        for (let count = PLAY_AREA_COUNT; count >= 1; count--) {\n            for (let i = 0; i < count; i++) {\n                let dis = PLAY_AREA_COUNT - count\n                let groupIndex = dis + i\n                let playPokerGrop = this._playArea[groupIndex]\n                let poker = this._closeGroup.pokers[this._closeGroup.pokers.length - 1]\n                this._closeGroup.pokers.length = this._closeGroup.pokers.length - 1\n                playPokerGrop.addPoker(poker)\n                EventMgr.getInstance().emit(EventGame_Enum.EVENT_GAME_INIT_GROUP, groupIndex, dis, poker, i)\n            }\n        }\n    }\n    /**改变玩牌区到收牌区数据*/\n    onPlayToReceive(poker: Poker) {\n        for (let index = 0; index < RECEIVE_AREA_COUNT; index++) {\n            let group: ReceiveGroup = this._receiveArea[index]\n            if (group.isNextPoker(poker)) {\n                let parent: PokerGrop = poker.parent\n                parent.removePoker(poker)\n                group.addPoker(poker)\n                EventMgr.getInstance().emit(EventGame_Enum.EVENT_PLAYAREA_TO_RECEIVE_UPDATE_VIEW, poker)\n            }\n        }\n    }\n    /**移除close顶部牌数据添加到open区数据*/\n    onCloseToOpen(poker: Poker) {\n        let parent: CloseGroup = poker.parent as CloseGroup\n        parent.removePoker(poker)\n        // console.log('当前closeGroup的pokers', this.closeGroup.pokers)\n        this.openGroup.addPoker(poker)\n        EventMgr.getInstance().emit(EventGame_Enum.EVENT_CLOSEAREA_TO_OPEN_UPDATE_VIEW, poker)\n    }\n\n    /**移除open顶部牌数据添加到receive区数据*/\n    onOpenToReceive(poker: Poker) {\n        let parent: OpenGroup = poker.parent\n\n        for (let index = 0; index < RECEIVE_AREA_COUNT; index++) {\n            let group: ReceiveGroup = this._receiveArea[index]\n            if (group.isNextPoker(poker)) {\n                // console.log('可以承接此牌', poker)\n                parent.removePoker(poker)\n                group.addPoker(poker)\n                EventMgr.getInstance().emit(EventGame_Enum.EVENT_OPEN_TO_RECEIVE_UPDATE_VIEW, poker)\n            }\n        }\n    }\n\n    //检测这张牌是否在play area\n    onCheckInPlayArea(poker: Poker): boolean {\n        return this.playArea.filter(\n            pg => pg.pokers.filter(p => p.count == poker.count && p.suit == poker.suit).length > 0\n        ).length > 0\n    }\n\n    //检测是否在顶部\n    onCheckIndexTop(poker: Poker) {\n        for (const gp of this._playArea) {\n            let pokers = gp.pokers\n            let topPoker = pokers[pokers.length - 1]\n            if (topPoker.count == poker.count && topPoker.suit == poker.suit)\n                return true\n        }\n\n        return false\n    }\n\n    //检测这张牌是否在close area\n    onCheckInCloseArea(poker: Poker): boolean {\n        return this.closeGroup.pokers.filter(\n            p => p.count == poker.count && p.suit == poker.suit\n        ).length > 0\n    }\n\n    //检测是否在closeArea顶部\n    onCheckIndexByCloseTop(p: Poker) {\n        console.log('当前点击的poker', p)\n        if (this._closeGroup.pokers.length <= 0)\n            return null\n        console.log('this._closeGroup.pokers', this._closeGroup.pokers)\n        for (const poker of this._closeGroup.pokers) {\n            let topPoker = this._closeGroup.groupTop\n            if (poker.count == p.count && poker.suit == p.suit)\n                return true\n        }\n\n        return false\n    }\n\n    //检测这张牌是否在open area\n    onCheckInOpenArea(poker: Poker): boolean {\n        return this.openGroup.pokers.filter(\n            p => p.count == poker.count && p.suit == poker.suit\n        ).length > 0\n    }\n\n    //检测是否在openArea顶部\n    onCheckIndexByOpenTop(poker: Poker) {\n        if (this.openGroup.pokers.length <= 0)\n            return null\n\n        for (const poker of this.openGroup.pokers) {\n            let topPoker = this.openGroup.pokers[this.openGroup.pokers.length - 1]\n            if (topPoker.count == poker.count && topPoker.suit == poker.suit)\n                return true\n        }\n\n        return false\n    }\n\n    public get pokers(): Poker[] { return this._pokers }\n    public get closeGroup(): CloseGroup { return this._closeGroup }\n    public get openGroup(): CloseGroup { return this._openGroup }\n    public get openPokers(): Poker[] { return this._openPokers }\n    public get playArea(): PlayGroup[] { return this._playArea }\n    public get receiveArea(): ReceiveGroup[] { return this._receiveArea }\n}\n"]}