{"version":3,"sources":["file:///Users/super_javan/cocoscreator/PlayCard/assets/Script/View/UIGameView.ts"],"names":["_decorator","Component","Node","Prefab","instantiate","Vec3","UITransform","tween","ECardDir","PLAY_AREA_COUNT","UIPoker","ccclass","property","UIGameView","onLoad","createAllCardByDB","pokers","index","poker","uiPoker","createUIPoker","initArea","addChild","node","setPosition","cardPrefab","getComponent","init","gamePlay","stuck","children","length","removeChild","push","card","closeSendArea","initPlayGroup","groupIndex","cardIndex","console","log","wolrdPos","convertToWorldSpaceAR","nodePos","playGruopRoot","convertToNodeSpaceAR","removeFromParent","position","setSiblingIndex","delay","nodeEndPos","dir","OPEN","scale","getScale","skewY","x","parallel","to","easing","call","setScale","start"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, Game, instantiate, Vec3, UITransform, Tween, tween } from 'cc';\nimport { ECardDir } from '../Enum';\nimport GameEngine from '../GameEngine';\nimport GameDB, { PLAY_AREA_COUNT } from '../Model/GameDB';\nimport Poker from '../Model/Poker';\nimport { UIPoker } from '../UI/UIPoker';\nimport TweenUtil from '../Utils/Utils';\nconst { ccclass, property } = _decorator;\n\n@ccclass('UIGameView')\nexport class UIGameView extends Component {\n    @property(Prefab)\n    cardPrefab: Prefab = null\n\n    @property(Node)\n    closeSendArea: Node = null\n    @property(Node)\n    openSendArea: Node = null\n    @property([Node])\n    receiveAreaList: Node[] = []\n    @property(Node)\n    playGruopRoot: Node = null\n    @property(Node)\n    initArea: Node = null\n\n    onLoad() {\n\n    }\n\n    createAllCardByDB(pokers: Poker[]) {\n        //先创建所有牌到init待发牌区\n        let index = 0\n        for (const poker of pokers) {\n            let uiPoker = this.createUIPoker(poker)\n            this.initArea.addChild(uiPoker.node)\n            uiPoker.node.setPosition(0.5 * index, 0.2 * index, 0)\n            index++\n        }\n    }\n\n    createUIPoker(poker: Poker): UIPoker {\n        const cardPrefab = instantiate(this.cardPrefab)\n        const uiPoker = cardPrefab.getComponent(UIPoker)\n        uiPoker.init(poker)\n        return uiPoker\n    }\n\n    //将牌移到close 收牌区\n    gamePlay() {\n        let stuck = []\n        for (let index = this.initArea.children.length - 1; index >= 0; --index) {\n            let children = this.initArea.children[index]\n            this.initArea.removeChild(children)\n            stuck.push(children)\n        }\n\n        for (let index = stuck.length - 1; index >= 0; --index) {\n            const card = stuck[index];\n            this.closeSendArea.addChild(card)\n        }\n    }\n\n    async initPlayGroup(groupIndex: number, cardIndex: number, poker: Poker) {\n        let index = PLAY_AREA_COUNT * cardIndex - cardIndex * (cardIndex - 1) / 2 - cardIndex + groupIndex\n        console.log('groupIndex:' + groupIndex + ',cardIndex:' + cardIndex + ',index:' + index)\n        let node = poker.UIPoker.node\n        let wolrdPos = node.getComponent(UITransform).convertToWorldSpaceAR(new Vec3(0, 0, 0))\n        let nodePos = this.playGruopRoot.getComponent(UITransform).convertToNodeSpaceAR(wolrdPos)\n        node.removeFromParent()\n        node.position = nodePos\n        this.playGruopRoot.addChild(node)\n        node.setSiblingIndex(index)\n\n        let delay = index * 0.2\n        let nodeEndPos = groupIndex * 92\n        if (poker.dir == ECardDir.OPEN) {\n            // tween(node)\n            //     .delay(delay)\n            //     .to(0.5, { position: new Vec3(nodeEndPos, cardIndex * -30, 0) })\n            //     .to(0.3, { scale: new Vec3(0, 0, 0) })\n            //     .call(() => {\n            //         poker.UIPoker.refreshView()\n            //     })\n            //     .to(0.3, { scale: new Vec3(1, 1, 1) })\n            //     .start()\n            let scale = node.getScale(),\n                skewY = scale.x > 0 ? 20 : -20;\n\n            tween(node)\n                .parallel(\n                    tween().to(0.4, { scale: new Vec3(0, 1, 1) }, { easing: 'quadIn' }),\n                    tween().to(0.4, { skewY: -skewY }, { easing: 'quadOut' }),\n                )\n                .call(() => {\n                })\n                .parallel(\n                    tween().to(0.4, { scale: new Vec3(-1, 1, 1) }, { easing: 'quadOut' }),\n                    tween().to(0.4, { skewY: 0 }, { easing: 'quadIn' }),\n                )\n                .call(() => {\n                    console.log('asasfasfasfwwwww')\n                    node.setScale(1, 1, 1);\n                })\n                .start();\n        } else {\n            tween(node)\n                .delay(delay)\n                .to(0.5, { position: new Vec3(nodeEndPos, cardIndex * -30, 0) })\n                .start()\n        }\n    }\n}\n\n"]}